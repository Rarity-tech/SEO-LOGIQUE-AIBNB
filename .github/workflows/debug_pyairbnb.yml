name: Debug Amenities Complet

on:
  workflow_dispatch:

jobs:
  debug:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          pip install pyairbnb==2.1.1 curl_cffi>=0.6.0
      
      - name: Run Debug Amenities
        run: |
          python << 'EOF'
          import json
          import pyairbnb

          # Tester plusieurs listings pour avoir une liste complete
          ROOM_IDS = [
              "1149961985722988324",
              "1047034344941569498",
              "53219622"
          ]

          all_amenities = set()

          for room_id in ROOM_IDS:
              print(f"\n{'='*80}")
              print(f"ROOM ID: {room_id}")
              print("="*80)
              
              try:
                  details = pyairbnb.get_details(
                      room_id=room_id,
                      currency="AED",
                      proxy_url="",
                      language="en",
                  )
                  
                  if not details:
                      print("Aucun detail")
                      continue
                  
                  amenities = details.get("amenities", [])
                  print(f"\nNombre de categories: {len(amenities)}")
                  
                  for category in amenities:
                      if isinstance(category, dict):
                          cat_title = category.get("title", "")
                          print(f"\n=== CATEGORIE: {cat_title} ===")
                          
                          values = category.get("values", [])
                          for item in values:
                              if isinstance(item, dict):
                                  title = item.get("title", "")
                                  subtitle = item.get("subtitle", "")
                                  available = item.get("available", True)
                                  
                                  status = "✅" if available else "❌"
                                  print(f"  {status} {title}")
                                  if subtitle:
                                      print(f"      -> {subtitle}")
                                  
                                  all_amenities.add(title)
                      
              except Exception as e:
                  print(f"Erreur: {e}")

          print("\n" + "="*80)
          print("LISTE COMPLETE DE TOUS LES AMENITIES UNIQUES")
          print("="*80)
          for am in sorted(all_amenities):
              print(f"  - {am}")
          
          print(f"\nTotal: {len(all_amenities)} amenities uniques")
          EOF
